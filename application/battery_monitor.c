/***********************************************************************************************************************
* ファイル名 : battery_monitor.c
* 説明 : バッテリーモジュール
***********************************************************************************************************************/

/***********************************************************************************************************************
include
***********************************************************************************************************************/
#include "battery_monitor.h"
#include "../driver/adchange.h"

/***********************************************************************************************************************
define and const
***********************************************************************************************************************/
#define VATTERY_ADC_BUFF_SIZE	4u

/***********************************************************************************************************************
global
***********************************************************************************************************************/
static uint16_t vattery_adc_value_buff[VATTERY_ADC_BUFF_SIZE];
static uint16_t battery_voltage_mV;
static uint8_t battery_buff_count;
/***********************************************************************************************************************
prototype
***********************************************************************************************************************/


/***********************************************************************************************************************
 * Function Name: init_battery
 * Description  : バッテリーモジュール初期化処理
 * Arguments    : none
 * Return Value : none
 ***********************************************************************************************************************/
void init_battery(void)
{
    uint8_t buff_index;

    for(buff_index = 0u; buff_index < VATTERY_ADC_BUFF_SIZE; buff_index++ ){
        vattery_adc_value_buff[buff_index] = 0u;
    }

    battery_buff_count = 0u;
}

/***********************************************************************************************************************
 * Function Name: update_battery
 * Description  : バッテリー値更新処理
 * Arguments    : none
 * Return Value : none
 ***********************************************************************************************************************/
void update_battery(void)
{
	vattery_adc_value_buff[battery_buff_count] = get_adc_value(3);

    battery_buff_count++;
	if(VATTERY_ADC_BUFF_SIZE <= battery_buff_count){
		battery_buff_count = 0;
	}
}
